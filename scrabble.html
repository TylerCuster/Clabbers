<html>
<script>

/*
write test suite: isValidHand
implement inheritence for Dictionary-like methods

isValidWord (string is in word dictionary) *USE JQUERY*
isInline (are the tiles in the possible play all in a horizontal or vertical line?)
isValidPlay (fits on board with current arrangement)
	use same pattern as isValidHand but add characters on board to the copy of the hand in the correct positions
Play.placeLetterFromHand
Play.isValidWord
Play.isInline
Play.isValidPlay
Play.isOccupied

Board different special bonus positions
Game
Turn
Player
*/

var HAND_SIZE = 7;
var BOARD_HEIGHT = 15;
var BOARD_WIDTH = 15;

var LETTER_VALUES = {"A": 1, "B": 3, "C": 3, "D": 2, "E": 1, "F": 4, "G": 2, "H": 4, "I": 1, "J": 8, "K": 5, "L": 1, "M": 3, "N": 1, "O": 1, "P": 3, "Q": 10, "R": 1, "S": 1, "T": 1, "U": 1, "V": 4, "W": 4, "X": 8, "Y": 4, "Z": 10, " ": 0}

var LETTER_COUNTS = {"A": 9, "B": 2, "C": 2, "D": 4, "E": 12, "F": 2, "G": 3, "H": 2, "I": 9, "J": 1, "K": 1, "L": 4, "M": 2, "N": 6, "O": 8, "P": 2, "Q": 1, "R": 6, "S": 4, "T": 6, "U": 4, "V": 2, "W": 2, "X": 1, "Y": 2, "Z": 1, " ": 2}

function randomInteger(below) {
	return Math.floor(Math.random() * below);
}

function forEachIn(object, action) {
  for (var property in object) {
    if (object.hasOwnProperty(property))
      action(property, object[property]);
  };
}

function calculateWordScore(word) {
	score = 0;
	forEachIn(word, function(letter, count) {
		score += LETTER_VALUES[letter] * count;
	});
	return score;
}

function wordToString(word) {
	var stringWord = "";
	forEachIn(word, function(letter, count) {
		for (var i = 0; i < count; i++) {
			stringWord += letter;
		};
	});
	return stringWord;
}
	
function Bag() {
	this.values = new Object(LETTER_COUNTS);
}
Bag.prototype.store = function(letter, value) {
  this.values[letter] = value;
};
Bag.prototype.lookup = function(letter) {
  return this.values[letter];
};
Bag.prototype.contains = function(letter) {
  return Object.prototype.hasOwnProperty.call(this.values, letter) &&
    Object.prototype.propertyIsEnumerable.call(this.values, letter);
};
Bag.prototype.each = function(action) {
  forEachIn(this.values, action);
};
Bag.prototype.remove = function(letter) {
	if (this.contains(letter) == false || (this.lookup(letter) < 0))
		throw "Bag doesn't contain letter";
	else
		this.store(letter, this.lookup(letter)-1);
}
Bag.prototype.createArray = function() {
	var lettersArray = [];
	this.each(function(letter, value) {
		for (var i = 0; i < value; i++) {
			lettersArray.push(letter);
			}
		});
	return lettersArray;
}
Bag.prototype.selectRandomLetter = function() {
	lettersArray = this.createArray();
	return lettersArray[randomInteger(lettersArray.length)];
}
Bag.prototype.count = function() {
	lettersArray = this.createArray();
	return lettersArray.length;
}

function Hand(startValues) {
  this.values = startValues || {}
}
Hand.prototype.store = function(letter, value) {
  this.values[letter] = value;
};
Hand.prototype.lookup = function(letter) {
  return this.values[letter];
};
Hand.prototype.contains = function(letter) {
  return Object.prototype.hasOwnProperty.call(this.values, letter) &&
    Object.prototype.propertyIsEnumerable.call(this.values, letter);
};
Hand.prototype.each = function(action) {
  forEachIn(this.values, action);
};
Hand.prototype.remove = function(letter) {
	if (this.contains(letter) == false || (this.lookup(letter) < 0))
		throw "Hand doesn't contain letter";
	else
		this.store(letter, this.lookup(letter)-1);
};
Hand.prototype.createArray = function() {
	var lettersArray = [];
	this.each(function(letter, value) {
		for (var i = 0; i < value; i++) {
			lettersArray.push(letter);
			}
		});
	return lettersArray;
}
Hand.prototype.grabLetter = function() {
	try {
	newLetter = bag.selectRandomLetter();
	if (this.contains(newLetter) == false) 
		this.store(newLetter, 1);
	else
		this.store(newLetter, this.lookup(newLetter)+1);
	bag.remove(newLetter);
	}
	catch (error) {
		throw "No bag initialized: " + error.message;
	}
}
Hand.prototype.initialHand = function() {
	for (var i = 0; i < HAND_SIZE; i++) {
		this.grabLetter();
	};
}
Hand.prototype.isValidHand = function(word) {
	copy = this.createArray();
	for (var i = 0; i < word.length; i++) {
		if (copy.indexOf(word[i]) == -1)
			return false;
		else
			delete copy[copy.indexOf(word[i])];
	};
	return true;
};
Hand.prototype.drawHand = function() {
	copy = this.createArray();
	handString = "<table border=\"1\"> <tr>";
	for (var i = 0; i < HAND_SIZE; i++) {
		if (copy[i])
			handString += "<td>" + copy[i] + "</td>";
		else
			handString += "<td> &nbsp;&nbsp;&nbsp; </td>"; 
		};
	handString += "</tr> + </table>";
	document.write(handString);
};

bag = new Bag();
hand = new Hand();
hand.initialHand();
hand.drawHand();
	
function Board(width, height) {
  this.width = width;
  this.height = height;
  this.cells = this.initial();
};
Board.prototype.initial = function() {
	var board = [];
	for (var i = 0; i < this.height; i++) {
		var row = [];
		for (var j = 0; j < this.width; j++) {
			row.push([j, null]);
		}
		board.push(row);
	}
	return board;
};
Board.prototype.valueAt = function(x, y) {
	try {
		return this.cells[y][x][1];
	}
	catch (error) {
		throw "Space not on game board: " + error.message;
	}
};
Board.prototype.placeLetter = function(x, y, letter) {
	if (this.valueAt(x, y) == null)
		this.cells[y][x][1] = letter;
};
Board.prototype.isInline = function(play) {
};
Board.prototype.each = function(func) {
	for (var i = 0; i < this.height; i++) {
		for (var j = 0; j < this.width; j++) {
			var tile = this.cells[i][j][0];
			func(tile, this.valueAt(j, i));
		}
	}
};
Board.prototype.drawBoard = function() {
	var boardWidth = this.width;
	var stringBoard = "<table border=\"1\">";
	var i = 1;
	this.each(function(tile, letter) {
		if (letter == null)
			stringBoard += "<td>&nbsp;&nbsp;&nbsp;</td>";
		else
			stringBoard += "<td>" + letter + "</td>";
		if (i % boardWidth == 0)
			stringBoard += "<tr>";
		i++;
		});
	stringBoard += "</table>"
	return document.write(stringBoard);
};

board = new Board(5, 5);
board.placeLetter(3, 2, "A");
board.placeLetter(1, 3, "B");
board.placeLetter(3, 3, "C");
board.drawBoard();

</script>
</html>